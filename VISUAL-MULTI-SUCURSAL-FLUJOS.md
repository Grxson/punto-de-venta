# ğŸ¨ Visual: CÃ³mo funciona el Sistema Multi-Sucursal

## Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND (React Native)                   â”‚
â”‚  - Obtiene token al login                                        â”‚
â”‚  - EnvÃ­a token en cada request                                   â”‚
â”‚  - Obtiene menÃº dinÃ¡mico desde API                               â”‚
â”‚  - Renderiza segÃºn orden_visualizacion                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• HTTP
                        (Authorization: Bearer <token>)
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BACKEND (Java Spring Boot)                â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€ SucursalContextFilter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. Intercepta request HTTP                             â”‚   â”‚
â”‚  â”‚ 2. Extrae JWT del header Authorization                 â”‚   â”‚
â”‚  â”‚ 3. Obtiene username del JWT                            â”‚   â”‚
â”‚  â”‚ 4. Busca Usuario en BD                                 â”‚   â”‚
â”‚  â”‚ 5. Lee usuario.sucursal_id                             â”‚   â”‚
â”‚  â”‚ 6. ThreadLocal: SucursalContext.setSucursal(1, "Centro")  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€ SucursalProductoService â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ obtenerProductosDisponibles() {                         â”‚   â”‚
â”‚  â”‚   Long sucursalId = SucursalContext.getSucursalId()    â”‚   â”‚
â”‚  â”‚   return repository.findBySucursalIdAndDisponible(1)   â”‚   â”‚
â”‚  â”‚ }                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€ SucursalProductoRepository â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SELECT sp FROM SucursalProducto sp                     â”‚   â”‚
â”‚  â”‚ WHERE sp.sucursal.id = 1                               â”‚   â”‚
â”‚  â”‚   AND sp.disponible = true                             â”‚   â”‚
â”‚  â”‚ ORDER BY sp.ordenVisualizacion ASC                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€ Base de Datos â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  productos (id, nombre, precio, ...)                  â”‚   â”‚
â”‚  â”‚  sucursal_productos (sucursal_id, producto_id,        â”‚   â”‚
â”‚  â”‚                      precio_sucursal, disponible,      â”‚   â”‚
â”‚  â”‚                      orden_visualizacion, ...)        â”‚   â”‚
â”‚  â”‚  sucursales (id, nombre, ...)                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de una venta (paso a paso)

### Usuario: Juan (Sucursal Centro)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. FRONTEND: Usuario abre app                                        â”‚
â”‚    - Lee token de AsyncStorage (si existe sesiÃ³n anterior)           â”‚
â”‚    - O muestra pantalla de login                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. FRONTEND: EnvÃ­a credenciales                                      â”‚
â”‚    POST /api/auth/login                                              â”‚
â”‚    {                                                                 â”‚
â”‚      "username": "juan",                                             â”‚
â”‚      "password": "password123"                                       â”‚
â”‚    }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. BACKEND: Valida y retorna token                                   â”‚
â”‚    {                                                                 â”‚
â”‚      "token": "eyJhbGciOiJIUzI1NiIs...",                            â”‚
â”‚      "usuario": {                                                    â”‚
â”‚        "id": 10,                                                     â”‚
â”‚        "nombre": "Juan PÃ©rez",                                       â”‚
â”‚        "rol": "VENDEDOR",                                            â”‚
â”‚        "sucursal_id": 1  â† SUCURSAL                                â”‚
â”‚      }                                                               â”‚
â”‚    }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. FRONTEND: Guarda token y sucursal                                 â”‚
â”‚    await AsyncStorage.setItem('authToken', token);                  â”‚
â”‚    setState({ sucursal: "Centro", usuario: data.usuario });         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. FRONTEND: Obtiene menÃº dinÃ¡mico                                   â”‚
â”‚    GET /api/sucursales/productos                                    â”‚
â”‚    Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIs...          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. BACKEND: SucursalContextFilter intercepta                         â”‚
â”‚    - Extrae JWT: eyJhbGciOiJIUzI1NiIs...                            â”‚
â”‚    - Decodifica: username = "juan"                                   â”‚
â”‚    - Busca Usuario: SELECT * FROM usuarios WHERE username = 'juan'  â”‚
â”‚    - Lee: usuario.sucursal_id = 1                                   â”‚
â”‚    - ThreadLocal: SucursalContext.setSucursal(1, "Centro")          â”‚
â”‚                                                                      â”‚
â”‚    âš ï¸ IMPORTANTE: Esto sucede ANTES de llegar al controlador         â”‚
â”‚       Todos los mÃ©todos pueden acceder a:                            â”‚
â”‚       Long sucursalId = SucursalContext.getSucursalId();           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. BACKEND: SucursalController recibe request                        â”‚
â”‚    @GetMapping("/productos")                                        â”‚
â”‚    public ResponseEntity<List<ProductoSucursalDTO>>                â”‚
â”‚    obtenerProductosMiSucursal() {                                  â”‚
â”‚      // Sucursal ya estÃ¡ en ThreadLocal gracias al Filter          â”‚
â”‚      return sucursalProductoService.obtenerProductosDisponibles();â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. BACKEND: Service obtiene sucursal del contexto                    â”‚
â”‚    public List<ProductoSucursalDTO> obtenerProductosDisponibles() {â”‚
â”‚      Long sucursalId = SucursalContext.getSucursalId(); // = 1     â”‚
â”‚      return obtenerProductosDisponibles(sucursalId);              â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. BACKEND: Repository ejecuta query                                 â”‚
â”‚    SELECT sp FROM SucursalProducto sp                               â”‚
â”‚    WHERE sp.sucursal.id = 1                                        â”‚
â”‚      AND sp.disponible = true                                      â”‚
â”‚    ORDER BY sp.ordenVisualizacion ASC                              â”‚
â”‚                                                                      â”‚
â”‚    Resultado (de BD):                                               â”‚
â”‚    [                                                                â”‚
â”‚      {id:1, sucursal_id:1, producto_id:1, precio_sucursal:2.50,   â”‚
â”‚       disponible:true, orden_visualizacion:1, horario:null,        â”‚
â”‚       dias:null, notas:null, producto:{id:1, nombre:"Jugo",...}}, â”‚
â”‚      {id:2, sucursal_id:1, producto_id:2, precio_sucursal:1.50,   â”‚
â”‚       disponible:true, orden_visualizacion:2, horario:null,        â”‚
â”‚       dias:null, notas:null, producto:{id:2, nombre:"CafÃ©",...}}  â”‚
â”‚    ]                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. BACKEND: Service mapea a DTO                                     â”‚
â”‚     ProductoSucursalDTO {                                            â”‚
â”‚       id: 1,                                                        â”‚
â”‚       nombre: "Jugo de Naranja",                                    â”‚
â”‚       precioBase: 2.50,                                             â”‚
â”‚       precioSucursal: 2.50,                                         â”‚
â”‚       disponible: true,                                             â”‚
â”‚       ordenVisualizacion: 1,                                        â”‚
â”‚       ...                                                           â”‚
â”‚     }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. BACKEND: Retorna JSON                                            â”‚
â”‚     HTTP 200 OK                                                      â”‚
â”‚     [                                                                â”‚
â”‚       {                                                              â”‚
â”‚         "id": 1,                                                     â”‚
â”‚         "nombre": "Jugo de Naranja",                                â”‚
â”‚         "precioBase": 2.50,                                         â”‚
â”‚         "precioSucursal": 2.50,                                     â”‚
â”‚         "disponible": true,                                         â”‚
â”‚         "ordenVisualizacion": 1,                                    â”‚
â”‚         "categoriaProducto": "Bebidas",                             â”‚
â”‚         "esProductoBase": true,                                     â”‚
â”‚         "horarioDisponibilidad": null,                              â”‚
â”‚         "diasDisponibilidad": null,                                 â”‚
â”‚         "notas": null                                               â”‚
â”‚       },                                                             â”‚
â”‚       {                                                              â”‚
â”‚         "id": 2,                                                     â”‚
â”‚         "nombre": "CafÃ©",                                            â”‚
â”‚         "precioBase": 1.50,                                         â”‚
â”‚         "precioSucursal": 1.50,                                     â”‚
â”‚         "disponible": true,                                         â”‚
â”‚         "ordenVisualizacion": 2,                                    â”‚
â”‚         "categoriaProducto": "Bebidas",                             â”‚
â”‚         ...                                                         â”‚
â”‚       }                                                              â”‚
â”‚     ]                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12. FRONTEND: Recibe y renderiza menÃº                                â”‚
â”‚     - Agrupa por categorÃ­a                                           â”‚
â”‚     - Ordena por ordenVisualizacion                                 â”‚
â”‚     - Renderiza en pantalla:                                         â”‚
â”‚                                                                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚     â”‚         MENÃš - Sucursal Centro          â”‚                    â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
â”‚     â”‚  ğŸ¥¤ BEBIDAS                             â”‚                    â”‚
â”‚     â”‚  1. Jugo de Naranja           $2.50     â”‚                    â”‚
â”‚     â”‚  2. CafÃ©                      $1.50     â”‚                    â”‚
â”‚     â”‚                                         â”‚                    â”‚
â”‚     â”‚  ğŸ REPOSTERÃA                          â”‚                    â”‚
â”‚     â”‚  1. Croissant                 $1.80     â”‚                    â”‚
â”‚     â”‚  2. Donas                     $2.00     â”‚                    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ComparaciÃ³n: Sucursal Centro vs Sur

```
USUARIO: Juan (Sucursal Centro, ID=1)
  Token JWT â†’ SucursalContext = 1
  GET /api/sucursales/productos
  
  â†“ Query: WHERE sucursal_id = 1 AND disponible = true
  
  RESULTADO (Base de Datos):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ sucursal_id â”‚ producto_id â”‚ precio â”‚ orden            â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚      1      â”‚      1      â”‚  2.50  â”‚   1  â† Jugo     â”‚
  â”‚      1      â”‚      2      â”‚  1.50  â”‚   2  â† CafÃ©     â”‚
  â”‚      1      â”‚      5      â”‚  1.80  â”‚   3  â† Croissantâ”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  â†“ Frontend renderiza
  
  ğŸ¥¤ BEBIDAS
    1. Jugo de Naranja     $2.50
    2. CafÃ©                $1.50
  
  ğŸ REPOSTERÃA
    1. Croissant           $1.80


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


USUARIO: MarÃ­a (Sucursal Sur, ID=2)
  Token JWT â†’ SucursalContext = 2
  GET /api/sucursales/productos
  
  â†“ Query: WHERE sucursal_id = 2 AND disponible = true
  
  RESULTADO (Base de Datos):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ sucursal_id â”‚ producto_id â”‚ precio â”‚ orden            â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚      2      â”‚      2      â”‚  2.00  â”‚   1  â† CafÃ©     â”‚
  â”‚      2      â”‚      1      â”‚  3.00  â”‚   2  â† Jugo     â”‚
  â”‚      2      â”‚      6      â”‚  5.00  â”‚   3  â† Ensalada â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  â†“ Frontend renderiza
  
  ğŸ¥¤ BEBIDAS
    1. CafÃ©                $2.00      â† Precio diferente
    2. Jugo de Naranja     $3.00      â† Precio diferente
  
  ğŸ½ï¸ COMIDAS
    1. Ensalada            $5.00      â† NO existe en Centro
```

---

## Â¿QuÃ© sucede si MarÃ­a cambia a "Ver como Sucursal Centro"? (Admin)

```
USUARIO: MarÃ­a (Admin, rol_id=1)
  Original sucursal_id: 2
  
  Request:
  GET /api/sucursales/1/productos
  Headers: Authorization: Bearer <token_de_maria>
  
  â†“ SucursalContextFilter:
    - Valida JWT
    - Lee usuario.sucursal_id = 2 (su sucursal)
    - PERO: Â¿Tiene permiso para ver sucursal 1?
    
    âš ï¸ Validar en el controller:
    @RequiredRole(value = {Rol.ADMIN, Rol.GERENTE})
    
  â†“ Query: WHERE sucursal_id = 1 AND disponible = true
  
  RESULTADO: MenÃº de Sucursal 1
  
  ğŸ¥¤ BEBIDAS
    1. Jugo de Naranja     $2.50      â† Como la ve Juan
    2. CafÃ©                $1.50
  
  ğŸ REPOSTERÃA
    1. Croissant           $1.80
```

---

## Tabla de Relaciones (Modelo E-R Simplificado)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PRODUCTOS      â”‚           â”‚   SUCURSALES         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)          â”‚           â”‚ id (PK)              â”‚
â”‚ nombre           â”‚           â”‚ nombre               â”‚
â”‚ precio           â”‚      *     â”‚ direccion            â”‚
â”‚ categoria_id (FK)â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”¤ activa               â”‚
â”‚ activo           â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ ...              â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
         1                    â”‚
         â”‚                    â”‚
         â”‚  *                 â”‚ *
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  SUCURSAL_PRODUCTOS          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                      â”‚
â”‚ sucursal_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ producto_id (FK) â”€â”€â”
â”‚ precio_sucursal    â”‚
â”‚ disponible         â”‚ Clave: UN producto puede estar en
â”‚ orden_visualizacionâ”‚ MÃšLTIPLES sucursales con
â”‚ horario_...        â”‚ DIFERENTES configuraciones
â”‚ dias_...           â”‚
â”‚ notas              â”‚
â”‚ UNIQUE(sucursal,   â”‚
â”‚        producto)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Seguridad y ValidaciÃ³n

```
â”Œâ”€ Request HTTP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/sucursales/productos      â”‚
â”‚ Authorization: Bearer <JWT>        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€ SucursalContextFilter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Valida JWT vÃ¡lido               â”‚ âœ“
â”‚ 2. Extrae username                 â”‚ âœ“
â”‚ 3. Busca Usuario en BD             â”‚ âœ“
â”‚ 4. Lee sucursal_id del usuario     â”‚ âœ“
â”‚ 5. Establece ThreadLocal           â”‚ âœ“
â”‚                                    â”‚
â”‚ âœ“ El usuario SOLO ve su sucursal   â”‚
â”‚ âœ“ No se puede cambiar por param    â”‚
â”‚ âœ— Admin ve su sucursal (se puede   â”‚
â”‚   mejorar con endpoint especial)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Resumen: Lo automÃ¡tico vs Lo manual

### âœ… AUTOMÃTICO (Backend ya lo hace)
- Filtrar productos por sucursal
- Obtener precio correcto por sucursal
- Obtener orden visual correto
- Validar disponibilidad
- Obtener horarios y dÃ­as

### âŒ MANUAL (Frontend debe hacer)
- Obtener menÃº dinÃ¡mico (en lugar de hardcodeado)
- Agrupar por categorÃ­a
- Ordenar por `ordenVisualizacion`
- Renderizar segÃºn disponibilidad horaria (opcional)
- UI para cambiar sucursal (si admin)
