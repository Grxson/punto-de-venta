# ========================================
# CONFIGURACIÓN PARA RAILWAY (PRODUCCIÓN)
# ========================================

# ----------------------------------------
# Información de la Aplicación
# ----------------------------------------
spring.application.name=PuntoDeVentaBackend
app.version=@app.version@
app.build=@app.build@
app.description=API RESTful para sistema de Punto de Venta

# ----------------------------------------
# Servidor
# ----------------------------------------
server.port=${PORT:8080}
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain
server.forward-headers-strategy=framework
server.tomcat.connection-timeout=20000
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10

# ----------------------------------------
# Base de Datos PostgreSQL (Railway)
# ----------------------------------------
# Railway provee DATABASE_URL automáticamente desde el servicio PostgreSQL vinculado
# Formato: postgresql://user:password@host:port/database
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/railway}
spring.datasource.driver-class-name=org.postgresql.Driver

# Pool de conexiones HikariCP
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# ----------------------------------------
# JPA / Hibernate
# ----------------------------------------
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.use_sql_comments=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# Ejecutar data.sql DESPUÉS de que Hibernate cree las tablas
spring.jpa.defer-datasource-initialization=true
spring.sql.init.mode=always
spring.sql.init.platform=postgresql
spring.sql.init.data-locations=classpath:data-postgresql.sql
spring.sql.init.continue-on-error=false

# ----------------------------------------
# Flyway (migraciones antes de Hibernate)
# ----------------------------------------
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.out-of-order=true

# ----------------------------------------
# Consola H2 (DESHABILITADA en producción)
# ----------------------------------------
spring.h2.console.enabled=false

# ----------------------------------------
# Documentación OpenAPI / Swagger
# ----------------------------------------
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.operations-sorter=method
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.doc-expansion=none
springdoc.swagger-ui.disable-swagger-default-url=true

# Información de la API
springdoc.info.title=Punto de Venta API
springdoc.info.description=API RESTful para gestión de ventas, inventario, finanzas y reportes
springdoc.info.version=@app.version@
springdoc.info.contact.name=Grxson
springdoc.info.contact.url=https://github.com/Grxson/punto-de-venta
springdoc.info.license.name=MIT
springdoc.info.license.url=https://opensource.org/licenses/MIT

# ----------------------------------------
# CORS (Producción - Apps móviles)
# ----------------------------------------
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:https://*.up.railway.app,capacitor://localhost}
cors.allowed-methods=GET,POST,PUT,PATCH,DELETE,OPTIONS
cors.allowed-headers=*
cors.allow-credentials=true
cors.max-age=3600

# ----------------------------------------
# Seguridad (Temporal - Cambiar en producción real)
# ----------------------------------------
spring.security.user.name=${ADMIN_USERNAME:admin}
spring.security.user.password=${ADMIN_PASSWORD:admin123}
spring.security.user.roles=ADMIN

# ----------------------------------------
# Actuator (Health checks para Railway)
# ----------------------------------------
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true
management.info.env.enabled=true
management.info.java.enabled=true
management.info.build.enabled=true

# ----------------------------------------
# Logging (Producción - Solo consola, Railway captura automáticamente)
# ----------------------------------------
logging.config=classpath:logback-railway.xml
logging.level.root=INFO
logging.level.com.puntodeventa=INFO
logging.level.org.springframework.web=WARN
logging.level.org.hibernate.SQL=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ----------------------------------------
# Virtual Threads (Java 21)
# ----------------------------------------
spring.threads.virtual.enabled=true

# ----------------------------------------
# Jackson (JSON)
# ----------------------------------------
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=America/Mexico_City
spring.jackson.default-property-inclusion=non_null

# ----------------------------------------
# Cache (Producción)
# ----------------------------------------
spring.cache.type=simple

# ----------------------------------------
# Error handling
# ----------------------------------------
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=never
server.error.include-exception=false
